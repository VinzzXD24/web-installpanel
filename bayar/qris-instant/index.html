<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QRIS INSTANT - VINZZ OFFICIAL</title>
  <link rel="icon" href="https://i.upimg.com/yHfVGNKK5" type="image/png" sizes="32x32">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    html, body { height:100%; margin:0; padding:0; overflow-x:hidden; }
    body { font-family:'Poppins', sans-serif; background:linear-gradient(135deg,#e0f7fa,#ffffff); color:#333; padding-bottom:100px; position:relative; }
    .cloud { position:fixed; background:#fff; border-radius:50%; box-shadow: inset -15px 0 10px rgba(0,0,0,0.1); opacity:0.8; z-index:-1; }
    .cloud1 { width:200px; height:60px; top:10%; animation:moveCloud 60s linear infinite; }
    .cloud2 { width:150px; height:45px; top:30%; animation:moveCloud 45s linear infinite 10s; }
    .cloud3 { width:180px; height:50px; top:50%; animation:moveCloud 75s linear infinite 5s; }
    @keyframes moveCloud { from { transform:translateX(-250px);} to { transform:translateX(100vw);} }
    .nav-container { display:flex; align-items:center; padding:.5rem 1rem; margin-top:1rem; }
    .card-custom { border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:transform .3s ease; background:#fff; }
    .card-custom:hover { transform:translateY(-5px);}  
    .header-gradient { background:linear-gradient(45deg,#4a90e2,#50e3c2); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .countdown { font-size:1.2rem; color:#dc3545; font-weight:600; }
    .fee-alert { background:#fff3e0; border-left:4px solid #ff9100; }
    .status-pending { color:#ffc107; font-weight:bold; }
    .status-success { color:#28a745; font-weight:bold; }
    .status-failed { color:#dc3545; font-weight:bold; }
    #toastContainer { position:fixed; top:20px; right:20px; z-index:1055; }
    .btn-primary { background:linear-gradient(45deg,#4a90e2,#50e3c2); border:none; transition:all .3s ease; }
    .btn-primary:hover { opacity:.9; transform:translateY(-2px); }
    .form-control { border-radius:10px; padding:12px 15px; }
    .form-control:focus { box-shadow:0 0 0 3px rgba(74,144,226,0.25); border-color:#4a90e2; }
    .copy-btn { padding:.2rem .4rem; font-size:.8rem; }
  </style>
</head>
<body>
  <div class="cloud cloud1"></div>
  <div class="cloud cloud2"></div>
  <div class="cloud cloud3"></div>

  <nav>
    <div class="nav-container">
      <a id="backBtn" href="javascript:void(0)" class="btn btn-link text-decoration-none"><i class="fas fa-arrow-left"></i></a>
      <h1 class="header-gradient fs-4 m-0">QRIS INSTANT</h1>
    </div>
  </nav>

  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6">
        <div id="formSection" class="card card-custom mb-4">
          <div class="card-body">
            <form id="paymentForm">
              <div class="mb-3">
                <label for="nominalInput" class="form-label">Nominal Pembayaran</label>
                <input type="number" id="nominalInput" class="form-control" min="500" required placeholder="Minimal Rp 500">
              </div>
              <div class="alert fee-alert mb-3">
                <small><i class="fas fa-info-circle"></i> Jumlah Ini Belum Termasuk Biaya Admin</small>
              </div>
              <button type="submit" class="btn btn-primary w-100"><i class="fas fa-qrcode"></i> Generate QRIS</button>
            </form>
          </div>
        </div>

        <div id="qrContainer" class="card card-custom" style="display:none;">
          <div class="card-body text-center">
            <img id="qrImage" src="" class="img-fluid mb-3" alt="QR Code">
            <div class="transaction-details text-start mb-4">
              <div class="row mb-2"><div class="col-6">ID Transaksi:</div><div class="col-6 d-flex justify-content-between align-items-center"><span id="transactionId">-</span><button class="btn btn-outline-secondary btn-sm copy-btn" data-copy-target="transactionId"><i class="fas fa-copy"></i></button></div></div>
              <div class="row mb-2"><div class="col-6">Reff ID:</div><div class="col-6 d-flex justify-content-between align-items-center"><span id="reffId">-</span><button class="btn btn-outline-secondary btn-sm copy-btn" data-copy-target="reffId"><i class="fas fa-copy"></i></button></div></div>
              <div class="row mb-2"><div class="col-6">Biaya:</div><div class="col-6"><span id="transactionFee" class="fw-bold text-danger">-</span></div></div>
              <div class="row mb-3"><div class="col-6">Total Bayar:</div><div class="col-6"><span id="totalAmount" class="fw-bold text-success">-</span></div></div>
            </div>
            <div id="countdown" class="countdown mb-3"></div>
            <div id="paymentStatus" class="mb-3"></div>
            <button id="cancelBtn" class="btn btn-danger mt-3 me-2"><i class="fas fa-times-circle"></i> Batalkan Pembayaran</button>
            <button id="newTxBtn" class="btn btn-success mt-3" style="display:none;"><i class="fas fa-sync-alt"></i> Transaksi Baru</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toastContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const API_KEY = 'sk-2CS8Oghs8pH5d8';
      let paymentData = null, intervalId = null, isProcessing = false;

      const backBtn = document.getElementById('backBtn');
      const form = document.getElementById('paymentForm');
      const formSection = document.getElementById('formSection');
      const qrContainer = document.getElementById('qrContainer');
      const qrImage = document.getElementById('qrImage');
      const txIdEl = document.getElementById('transactionId');
      const reffIdEl = document.getElementById('reffId');
      const feeEl = document.getElementById('transactionFee');
      const totalEl = document.getElementById('totalAmount');
      const countdownEl = document.getElementById('countdown');
      const statusEl = document.getElementById('paymentStatus');
      const cancelBtn = document.getElementById('cancelBtn');
      const newTxBtn = document.getElementById('newTxBtn');

      backBtn.addEventListener('click', endFlow);

      function showToast(msg, type='info') {
        const id = 't' + Date.now();
        const html = `<div id="${id}" class="toast align-items-center text-white bg-${type} border-0 mb-2" role="alert"><div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div>`;
        document.getElementById('toastContainer').insertAdjacentHTML('beforeend', html);
        const toastEl = document.getElementById(id);
        new bootstrap.Toast(toastEl, { delay: 3000 }).show();
        toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
      }

      function calculateFee(n) { return Math.ceil(n * 0.014); }

      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const txt = document.getElementById(e.currentTarget.dataset.copyTarget).textContent;
          navigator.clipboard.writeText(txt).then(() => showToast(`Copied: ${txt}`, 'success'));
        });
      });

      form.addEventListener('submit', async e => {
        e.preventDefault();
        const nominal = parseInt(document.getElementById('nominalInput').value, 10);
        if (!nominal || nominal < 500) { showToast('Minimal pembayaran Rp 500', 'warning'); return; }
        isProcessing = true;
        form.querySelector('button[type="submit"]').disabled = true;
        showToast('Memproses pembayaran...', 'info');
        try {
          const res = await fetch('https://forestapi.web.id/api/h2h/deposit/create', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body:JSON.stringify({ nominal, method:'QRISFAST', fee_by_customer:'false', reff_id:'deposit-vinzz-'+Date.now(), api_key:API_KEY })
          });
          const data = await res.json();
          if (data.status==='success') {
            paymentData = data.data;
            showQRCode(); startCountdown(); showToast('Berhasil dibuat', 'success');
            localStorage.setItem('vinzzPaymentData', JSON.stringify(paymentData));
          } else showToast('Gagal: '+data.message, 'danger');
        } catch(err) { showToast('Error: '+err.message, 'danger'); }
        finally { isProcessing=false; form.querySelector('button[type="submit"]').disabled=false; }
      });

      cancelBtn.addEventListener('click', async () => {
        if (!paymentData) return;
        showToast('Membatalkan...', 'info');
        try {
          const res = await fetch('https://forestapi.web.id/api/h2h/deposit/cancel', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ id:paymentData.id, api_key:API_KEY }) });
          const result = await res.json();
          if (result.status==='success') { showToast('Dibatalkan','warning'); endFlow(); } else showToast('Gagal: '+result.message,'danger');
        } catch(err) { showToast('Error: '+err.message,'danger'); }
      });

      newTxBtn.addEventListener('click', () => { endFlow(); showToast('Transaksi baru', 'info'); });

      function showQRCode() {
        formSection.style.display='none'; qrContainer.style.display='block';
        qrImage.style.display = paymentData.status==='pending'?'block':'none';
        txIdEl.textContent = paymentData.id;
        reffIdEl.textContent = paymentData.reff_id;
        feeEl.textContent = 'Rp ' + paymentData.fee.toLocaleString('id-ID');
        totalEl.textContent = 'Rp ' + (paymentData.nominal+paymentData.fee).toLocaleString('id-ID');
        statusEl.innerHTML = `<strong>Status:</strong> <span class="${getStatusClass(paymentData.status)}">${paymentData.status}</span>`;
        cancelBtn.style.display = paymentData.status==='pending'?'inline-block':'none';
        newTxBtn.style.display = paymentData.status!=='pending'?'inline-block':'none';
      }

      function endFlow() {
        clearInterval(intervalId); paymentData=null; localStorage.removeItem('vinzzPaymentData');
        formSection.style.display='block'; qrContainer.style.display='none';
      }

      function getStatusClass(s) { const key=s.toLowerCase(); return key==='pending'?'status-pending':key==='success'?'status-success':'status-failed'; }

      function startCountdown() {
        const expTime = new Date(paymentData.expired_at).getTime();
        intervalId = setInterval(() => {
          const diff = expTime - Date.now();
          if (diff <= 0) { clearInterval(intervalId); statusEl.innerHTML=`<strong>Status:</strong> <span class="status-failed">expired</span>`; cancelBtn.style.display='none'; newTxBtn.style.display='inline-block'; showToast('Kedaluwarsa','danger'); return; }
          const m = Math.floor((diff % (1000*60*60)) / (1000*60)); const s = Math.floor((diff % (1000*60)) / 1000);
          countdownEl.textContent = `Selesaikan dalam ${m}m ${s}s`;
        }, 1000);
      }

      const saved = localStorage.getItem('vinzzPaymentData');
      if (saved) {
        paymentData = JSON.parse(saved);
        if (new Date(paymentData.expired_at) > new Date()) { showQRCode(); startCountdown(); }
        else localStorage.removeItem('vinzzPaymentData');
      }
    });
  </script>
</body>
</html>
